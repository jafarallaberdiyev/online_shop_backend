{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{% static 'css/bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/my_css.css' %}">
    <link rel="stylesheet" href="{% static 'css/my_footer_css.css' %}">

    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
    <title>Home</title>
</head>
<body>
{% include 'partials/navbar.html' %}

<section class="pb-2 mb-2">
  <div class="container pb-2 mb-2">

        <div class="row mt-1 position-fixed z-3">

            <!-- Каталог -->
            <div class="dropdown mb-2">
                <button class="btn btn-secondary dropdown-toggle btn-dark" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                    Каталог
                    <img class="mx-1" src="{% static 'icons/grid-fill.svg' %}" alt="Catalog Icon" width="16" height="16">
                </button>

                <ul class="dropdown-menu dropdown-menu-dark">
                    <li><a class="dropdown-item" href="{% url 'catalog:catalog' %}">Все товары</a></li>

                    {% for c in categories %}
                      <li>
                        <a class="dropdown-item" href="{% url 'catalog:catalog' %}?category={{ c.slug }}">{{ c.name }}</a>
                      </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Значок корзины — страница корзины -->
            <div class="col-auto">
                <a class="btn btn-dark d-inline-flex align-items-center gap-1 px-2 py-1"
                href="{% url 'cart:detail' %}">
                <img class="mx-1" src="{% static 'icons/basket2-fill.svg' %}" width="25" height="25" alt="">
                <span id="goods-in-cart-count">{{ cart.items|length }}</span>
                </a>
            </div>

        </div>

        <div style="height: 90px;"></div>
    </div>

    <!-- Контент -->
    <div class="container">
        <div class="row mt-1">
            <div class="col-lg-2"></div>
            <div class="col-lg-10">
                <h1 class="mb-4 hero-title"><strong>Магазин мебели HOME</strong></h1>

                {% if featured %}

                <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
                    {% for p in featured %}
                    <div class="col">
                        <div class="card h-100">
                            <div class="position-relative">
                                {% if p.image %}
                                <img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.title }}">
                                {% else %}
                                <img src="{% static 'images/placeholder.png' %}" class="card-img-top" alt="">
                                {% endif %}

                                {% if p.old_price and p.old_price > p.price %}
                                <span class="badge bg-warning text-dark"
                                      style="position:absolute;top:10px;right:10px;padding:.35rem .6rem;border-radius:.4rem;font-weight:700;box-shadow:0 8px 22px rgba(0,0,0,.25);">
                                {% if p.discount_percent %}Скидка {{ p.discount_percent }} %{% else %}Скидка{% endif %}
                                 </span>
                                {% endif %}
                            </div>

                            <div class="card-body d-flex flex-column">
                                <a href="{% url 'catalog:product_detail' slug=p.slug %}" class="text-decoration-none">
                                    <p class="card-title mb-1">{{ p.title }}</p>
                                </a>
                                <p class="card-text text-truncate">{{ p.description }}</p>

                                <div class="mt-auto d-flex align-items-center gap-2 flex-wrap">
                                    {% if p.old_price and p.old_price > p.price %}
                                    <p class="mb-0"><s>{{ p.old_price }}</s> $</p>
                                    {% endif %}
                                    <p class="mb-0"><strong>{{ p.price }} $</strong></p>

                                    <form action="{% url 'cart:add' p.id %}" method="post" class="ms-auto">
                                        {% csrf_token %}
                                        <input type="hidden" name="qty" value="1">
                                        <button class="btn btn-outline-dark" title="Добавить в корзину">
                                            <img class="mx-1" src="{% static 'icons/cart-plus.svg' %}" alt="+"
                                                 width="24" height="24">
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                {% endif %}
            </div>
        </div>
    </div>
</section>




<!-- Scripts -->

<script src="{% static 'js/jquery/jquery-3.7.0.min.js' %}"></script>
<script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/jquery-events.js' %}"></script>
<script src="{% static 'js/jquery-ajax.js' %}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modalEl = document.getElementById('cartModal');
    modalEl?.addEventListener('hidden.bs.modal', function () { location.reload(); });
  });
</script>
</body>
</html>
